<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>BrickStock - Rangements</title>
        <link rel="stylesheet" type="text/css" href="/BrickStock/css/styles.css">
        <!-- <link rel="stylesheet" type="text/css" href="../css/styles.css"> -->
        <link rel="shortcut icon" href="/BrickStock/css/favicon.ico" type="image/x-icon">
        <!-- <link rel="shortcut icon" href="../css/favicon.ico" type="image/x-icon"> -->
    </head>
    <body>
        <div class="page">
            <div class="menu">
                <ul>
                    <li>
                        <a href="/BrickStock/pieces">Pièces</a></li><li>
                        <a href="/BrickStock/designs">Designs</a></li><li>
                        <a href="/BrickStock/categories">Categories</a></li><li>
                        <a href="/BrickStock/couleurs">Couleurs</a></li><li class="main">
                        <a href="/BrickStock/rangements">Rangements</a></li><li>
                        <a href="/BrickStock/sets">Sets</a></li><li>
                        <a href="/BrickStock/minifigures">Minifigures</a>
                    </li>
                </ul>
            </div>
            <div class="layout">
                <!-- <button id="ajouter" class="ajouter"><img src="/BrickStock/images/bouton_plus_carre.svg"></button> -->
                <div style="text-align: center;">
                    <h3 style="text-align: center;">{path_rangement}</h3>
                    <a style="display: inline-block; position: relative; vertical-align: top; color: inherit; text-decoration: none;" href="{qr_code_href}" target="_blank">
                        <img class="item_img" style="border: none; width: 50px;" src="{qr_code_href}">
                        <br/><span>{id_qr-code}</span>
                    </a>
                    <div class="infos_set">
                        <span>identifiant du rangement&nbsp;: {id_rangement}</span><br/>
                        <span>type de rangement&nbsp;: {type_rangement}</span>
                    </div>
                </div>
                <div style="text-align: left; padding: 24px;" id="list_piece_in_rangement">
                    {content}
                </div>
                <form method="POST" style="margin: 0 24px 24px; text-align: center; width: calc(100% - 48px);">
                    <input type="hidden" name="form_name" value="save_data">
                    <input type="hidden" name="id_rangement" value="{id_rangement}">
                    <input type="hidden" name="liste_pieces" id="liste_pieces_input">
                    <input type="submit" value="ENREGISTRER" class="bouton_validation_infos enregistrer" style="border-radius: 4px; width: 140px;">
                </form>
                <div style="text-align: left; margin: 0 24px; padding: 24px 0; border-top: 1px solid #404040;" id="search_zone">
                    <div class="filter_zone">
                        <a class="bouton_refresh" href="" id="boutonRefresh"></a>
                        <h3>Filtres&nbsp;:</h3>
                        <form method="POST" id="form_search" action="/BrickStock/rangements?id_rangement={id_rangement}#search_zone">
                            <input type="hidden" name="form_name" value="search_piece">
                            <input type="hidden" name="liste_pieces" id="liste_pieces_input_search">
                            <span>Nom&nbsp;:</span><br/>
                            <input type="text" name="nom" value="{nom_search}" placeholder="saisissez un nom" id="filter1"><img src="/BrickStock/images/del_filter.svg" class="del_filter hide" id="del1">
                            <separator></separator>
                            <span>Design&nbsp;:</span><br/>
                            <input type="text" name="id_design" value="{id_design_search}" placeholder="saisissez un nom" id="filter2"><img src="/BrickStock/images/del_filter.svg" class="del_filter hide" id="del2">
                            <separator></separator>
                            <span>Dimensions&nbsp;:</span><br/>
                            <input type="text" name="dimensions" value="{dimensions_search}" placeholder="lxLxh" id="filter3"><img src="/BrickStock/images/del_filter.svg" class="del_filter hide" id="del3">
                            <separator></separator>
                            <span>Catégorie&nbsp;:</span><br/>
                            <select name="categorie" id="filter4">
                                <option value="0">--sélectionner une catégorie--</option>
                                {liste_cat}
                            </select><img src="/BrickStock/images/del_filter.svg" class="del_filter hide" id="del4">
                            <separator></separator>
                            <span>Sous-catégorie&nbsp;:</span><br/>
                            <select name="sous_categorie" id="filter5">
                                <option value="0">--sélectionner une sous-catégorie--</option>
                            </select><img src="/BrickStock/images/del_filter.svg" class="del_filter hide" id="del5">
                            <separator></separator>
                            <input type="submit" value="Rechercher" class="rechercher">
                        </form>
                    </div><div class="table_zone" style="padding: 0; width: calc(100% - 289px - 48px + 24px);">
                        {cases}
                    </div>
                </div>
            </div>
        </div>
        {script}
        <script type="text/javascript" name="gestion filtres - 1/2">
            let defaut = {1 : "", 2 : "", 3 : "", 4 : 0, 5 : 0};
            let indexFilterTon = 0;
            let indexFilterCategories = 4;
        </script>
        <script type="text/javascript" src="/BrickStock/javascript/gestion_filtres.js"></script>
        <script type="text/javascript" name="gestion filtres - 2/2">
            addEventListenerForFiltres(5);
        </script>
        <script type="text/javascript" name="gestion listes déroulantes">
            let filterCategorie = document.getElementById("filter4");
            let filterSousCategorie = document.getElementById("filter5");
            let dictCategories = {liste_sous_categories};
            let listeCategories = {liste_all_categories};
            let categorieFilter = "{categorie_filter}";

            let indexFilterSousCategories = 5;
        </script>
        <script type="text/javascript" src="/BrickStock/javascript/gestion_listes_deroulantes_categories.js"></script>
        <script type="text/javascript" name="data">
            let resultats = {resultats};
        </script>
        <script type="text/javascript" name="conversion dict (object) -> string et list.remove">
            function str(dict) {
                var chaine = "{";
                var cles = Object.keys(dict)
                for (var i=0; i<cles.length; i++) {
                    if (i > 0) {
                        chaine = chaine + ", ";
                    }
                    chaine = chaine + cles[i] + " : " + dict[cles[i]];
                }
                chaine = chaine + "}";
                return chaine;
            }

            function indexOf(liste, item) {
                for (var i=0; i<liste.length; i++) {
                    if (liste[i] == item) {
                        return i;
                    }
                }
                return -1;
            }

            function listRemove(liste, item) {
                if (liste.includes(item)) {
                    var i = indexOf(liste, item);
                    var new_liste = [];
                    for (var j=0; i<liste.length; j++) {
                        if (j != i) {
                            new_liste.push(liste[j]);
                        }
                    }
                    return new_liste;
                }
                else {
                    return liste;
                }
            }
        </script>
        <script type="text/javascript" name="gestion input liste pieces">
            let valueInput = {value_input};
            let piecesInput = document.getElementById("liste_pieces_input");
            let piecesInputSearch = document.getElementById("liste_pieces_input_search");
            let listeNumItem = [];
            i = 1;
            while (document.getElementById("val" + i) !== null) {
                listeNumItem.push(i);
                i++
            }
            let nextIndex = listeNumItem.length + 1;
            let nbPiece = Object.keys(valueInput).length;

            // function alignementMinifigInSet(nbPieceInLine=5) {
            //     for (var k=0; k<listeNumItem.length; k++) {
            //         var item = document.getElementById("item_minifig" + listeNumItem[k]);
            //         if (item.classList.contains("last") & k % nbPieceInLine != (nbPieceInLine - 1)) {
            //             item.classList.remove("last");
            //         }
            //         else if (!item.classList.contains("last") & k % nbPieceInLine == (nbPieceInLine - 1)) {
            //             item.classList.add("last");
            //         }
            //     }
            // }

            function setInput() {
                piecesInput.value = str(valueInput);
                piecesInputSearch.value = piecesInput.value;
            }

            setInput();
        </script>
        <script type="text/javascript" name="alignement resultats">
            function alignementResultats(nbOnLigne=3) {
                var n = 1;
                for (var i=1; i<=resultats.length; i++) {
                    var item = document.getElementById("resultat" + i);
                    if (item.classList.contains("last")) {
                        item.classList.remove("last");
                    }
                    if (!item.classList.contains("hide")) {
                        if (n % nbOnLigne == 0) {
                            item.classList.add("last");
                        }
                        n++
                    }
                }
            }
        </script>
        <script type="text/javascript" name="ajout d'une minifig">
            let zoneMinifigInSet = document.getElementById("list_minifig_in_set");

            function ajouterMinifig(e) {
                var n = this.id.substring(7);
                var data = resultats[n - 1];
                var i = nextIndex;
                document.getElementById("resultat" + n).classList.add("hide");
                var divItemMinifig = document.createElement("div");
                divItemMinifig.classList.add("item_minifig");
                divItemMinifig.id = "item_minifig" + i;
                var imgBoutonSupprimer = document.createElement("img");
                imgBoutonSupprimer.classList.add("supprimer_item");
                imgBoutonSupprimer.src = "http://localhost:1520/BrickStock/images/croix.svg";
                imgBoutonSupprimer.id = "bouton_supprimer" + i;
                divItemMinifig.appendChild(imgBoutonSupprimer);
                var imgApercu = document.createElement("img");
                imgApercu.classList.add("apercu");
                imgApercu.src = data["image_ref"];
                divItemMinifig.appendChild(imgApercu);
                var spanId = document.createElement("span");
                spanId.innerHTML = "ID&nbsp;: " + data["id_minifig"];
                divItemMinifig.appendChild(spanId);
                divItemMinifig.innerHTML = divItemMinifig.innerHTML + "<br/>";
                var spanNom = document.createElement("span");
                spanNom.innerHTML = data["nom"];
                divItemMinifig.appendChild(spanNom);
                var divQuantiteBox = document.createElement("div");
                divQuantiteBox.classList.add("quantity_box");
                divQuantiteBox.style = "margin-top: 12px;";
                var buttonMoins = document.createElement("button");
                buttonMoins.classList.add("bouton_moins");
                buttonMoins.id = "-" + i;
                buttonMoins.type = "button";
                buttonMoins.style = "width: 50px;";
                buttonMoins.innerHTML = '<svg class="minus" width="14px" height="2px" viewBox="0 0 14 2" aria-hidden="true"><polygon fill="black" points="14 2 0 2 0 -6.03961325e-14 14 -6.03961325e-14"></polygon></svg>';
                divQuantiteBox.appendChild(buttonMoins);
                var inputValeur = document.createElement("input");
                inputValeur.id = "val" + i;
                inputValeur.classList.add("valeur");
                inputValeur.required = "";
                inputValeur.type = "number";
                inputValeur.style = "width: 56px;";
                inputValeur.min = 0;
                inputValeur.name = "quantite";
                inputValeur.value = 1;
                divQuantiteBox.appendChild(inputValeur);
                var buttonPlus = document.createElement("button");
                buttonPlus.id = "+" + i;
                buttonPlus.classList.add("bouton_plus")
                buttonPlus.type = "button";
                buttonPlus.style = "width: 50px;";
                buttonPlus.innerHTML = '<svg class="add" xmlns="http://www.w3.org/2000/svg" width="14px" height="14px" viewBox="0 0 14 14" aria-hidden="true"><polygon fill="#FFFFFF" points="14 8 0 8 0 6 14 6"></polygon><rect fill="#FFFFFF" fill-rule="nonzero" x="6" y="0" width="2" height="14"></rect></svg>';
                divQuantiteBox.appendChild(buttonPlus);
                divItemMinifig.appendChild(divQuantiteBox);
                var spanIdMinifig = document.createElement("span");
                spanIdMinifig.id = "id_minifig_in_set" + i;
                spanIdMinifig.classList.add("hide");
                spanIdMinifig.innerHTML = data["id_minifig"];
                divItemMinifig.appendChild(spanIdMinifig);
                zoneMinifigInSet.appendChild(divItemMinifig);
                listeNumItem.push(i);
                valueInput[data["id_minifig"]] = 1;
                nextIndex++
                setInput();
                document.getElementById("bouton_supprimer" + i).addEventListener("click", supprimerMinifig);
                document.getElementById("-" + i).addEventListener("click", moins);
                document.getElementById("val" + i).addEventListener("input", verif);
                document.getElementById("+" + i).addEventListener("click", plus);
                alignementResultats(3);
                alignementMinifigInSet(5);
            }
            
            var i = 0;
            while (document.getElementById("ajouter" + (i + 1)) !== null) {
                i++
            }
            for (var j=1; j<=i; j++) {
                document.getElementById("ajouter" + j).addEventListener("click", ajouterMinifig);
            }
        </script>
        <script type="text/javascript" name="suppression de minifig">
            function showResult(idFig) {
                for (var i=0; i<resultats.length; i++) {
                    if (resultats[i]["id_minifig"] == idFig) {
                        document.getElementById("resultat" + (i + 1)).classList.remove("hide");
                        return;
                    }
                }
            }

            function supprimerMinifig(e) {
                var i = this.id.substring(16);
                var idFig = document.getElementById("id_minifig_in_set" + i).innerHTML;
                listeNumItem = listRemove(listeNumItem, i);
                delete valueInput[idFig];
                var item = document.getElementById("item_minifig" + i);
                item.classList.add("hide");
                item.innerHTML = "";
                setInput();
                showResult(idFig);
                alignementResultats(3);
                alignementMinifigInSet(5);
            }

            for (var i=0; i<listeNumItem.length; i++) {
                document.getElementById("bouton_supprimer" + listeNumItem[i]).addEventListener("click", supprimerMinifig);
            }
        </script>
        <script type="text/javascript" name="masquage minifig in set">
            for (var i=1; i<=resultats.length; i++) {
                if (Object.keys(valueInput).includes(document.getElementById("id_minifig" + i).innerHTML)) {
                    document.getElementById("resultat" + i).classList.add("hide");
                }
            }

            alignementResultats(3);
        </script>
    </body>
</html>